---
title: "Pulling Data Sets"
author: "Hun Lee (sl4836), Jimmy Kelliher (jmk2303), Tanvir Khan (tk2886), Tucker Morgan (tlm2152), Zachary Katz (zak2132)"
date: "11/17/2021"
output: github_document
---

```{r setup, message = FALSE}
library(tidyverse)
library(httr)
library(readxl)
```

Below, we import United States Census data from the American Community Survey (ACS) 2019 five-year estimate via [IPUMS](https://usa.ipums.org/usa/). This data includes demographic and macroeconomic data by Public Use Microdata Area (PUMA) for New York City.
```{r IPUMS data import}
# space for Jimmy to import updated IPUMS

```

Next, we bring in monthly health outcomes from [NYC Department of Health and Mental Hygiene](https://github.com/nychealth/coronavirus-data) (DOHMH) as of 11/18/2021. We will primarily analyze data related to COVID-19 hospitalizations and deaths.
```{r health outcomes import, message = FALSE}
hosp_rate_url = "https://raw.githubusercontent.com/nychealth/coronavirus-data/master/trends/hosprate-by-modzcta.csv"

hosp_rate_zcta <- read_csv(hosp_rate_url)

death_rate_url = "https://raw.githubusercontent.com/nychealth/coronavirus-data/master/trends/deathrate-by-modzcta.csv"

death_rate_zcta <- read_csv(death_rate_url)
```

```{r writing outcome data, eval = FALSE}
write_csv(hosp_rate_zcta, "./data/nyc_hosp_rate_zcta.csv")
write_csv(death_rate_zcta, "./data/nyc_death_rate_zcta.csv")
```


Below, we import vaccination data from [nyc.gov](https://www1.nyc.gov/site/doh/covid/covid-19-data-vaccines.page) containing information on the number and estimated percentage of NYC residents who are fully or partially vaccinated by Modified ZCTA (MODZCTA) as of 11/17/2021.
```{r importing nyc.gov vaccination data, message = FALSE}
vacc_url = "https://raw.githubusercontent.com/nychealth/covid-vaccine-data/main/people/coverage-by-modzcta-allages.csv"

nyc_vacc_zcta <- read_csv(vacc_url)
head(nyc_vacc_zcta)
```

```{r writing vaccination data to csv, eval = FALSE}
write_csv(nyc_vacc_zcta, "./data/nyc_vacc_zcta.csv")
```

Below, we import broadband adoption and infrastructure data by zip code from [NYC Open Data](https://data.cityofnewyork.us/City-Government/Broadband-Adoption-and-Infrastructure-by-Zip-Code/qz5f-yx82/data). 
```{r broadband data, message = FALSE}
nyc_broadband <- 
  GET("https://data.cityofnewyork.us/resource/qz5f-yx82.json") %>% 
  content("text") %>% 
  jsonlite::fromJSON() %>%
  as_tibble()
head(nyc_broadband)
```

```{r writing broadband data to csv, eval = FALSE}
write_csv(nyc_broadband, "./data/nyc_broadband.csv")
```

Finally, we will import crosswalk data sets from [Baruch College](https://www.baruch.cuny.edu/confluence/display/geoportal/NYC+Geographies) to be utilized in relating ZCTA's, zip codes, and PUMAs.
```{r crosswalks for ZCTAs zipcodes and PUMAs, eval = FALSE}
zcta_puma_url = "http://faculty.baruch.cuny.edu/geoportal/resources/nyc_geog/nyc_zcta10_to_puma10.xls"

zcta_puma_cross <- read_excel(zcta_puma_url) # issue here, link on the website seems broken

zcta_zip_url = "http://faculty.baruch.cuny.edu/geoportal/resources/nyc_geog/zip_to_zcta10_nyc_revised.xls"

zcta_zip_cross <- read_excel(zcta_zip_url) # issue here, link on the website seems broken
```

